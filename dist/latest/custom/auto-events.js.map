{"version":3,"file":"auto-events.source.js","sources":["auto-events.source.js"],"sourcesContent":["(function saAutomatedEvents(window) {\n  // Skip server side rendered pages\n  if (typeof window === \"undefined\") return;\n\n  var log = function (message, type) {\n    var logger = type === \"warn\" ? console.warn : console.info;\n    return logger && logger(\"Simple Analytics auto events:\", message);\n  };\n\n  var doc = window.document;\n\n  var scriptElement =\n    doc.currentScript || doc.querySelector('script[src*=\"auto-events.js\"]');\n\n  var setting = function (attribute, type, defaultValue) {\n    var value = scriptElement && scriptElement.dataset[attribute];\n\n    // Booleans\n    if (type === \"bool\" && (value === \"true\" || value === \"false\"))\n      return value === \"true\";\n    else if (type === \"bool\") return defaultValue;\n\n    // Arrays\n    if (type === \"array\" && value)\n      return value\n        .split(\",\")\n        .map(function (item) {\n          return item.trim();\n        })\n        .filter(Boolean);\n    else if (type === \"array\") return defaultValue;\n\n    return value || defaultValue;\n  };\n\n  var collectTypes = setting(\"collect\", \"array\", [\n    \"outbound\",\n    \"emails\",\n    \"downloads\",\n  ]);\n  var fullUrls = setting(\"fullUrls\", \"bool\", false);\n\n  var options = {\n    // What to collect\n    outbound: collectTypes.indexOf(\"outbound\") > -1,\n    emails: collectTypes.indexOf(\"emails\") > -1,\n    downloads: collectTypes.indexOf(\"downloads\") > -1,\n    // Downloads: enter file extensions you want to collect\n    downloadsExtensions: setting(\"extensions\", \"array\", [\n      \"pdf\",\n      \"csv\",\n      \"docx\",\n      \"xlsx\",\n      \"zip\",\n      \"doc\",\n      \"xls\",\n    ]),\n\n    // All: use title attribute if set for event name (for all events)\n    // THIS TAKES PRECEDENCE OVER OTHER SETTINGS BELOW\n    title: setting(\"useTitle\", \"bool\", true),\n    // Outbound: use full URL of the links? false for just the hostname\n    outboundFullUrl: fullUrls,\n    // Downloads: if taking event name from URL, use full URL or just filename (default)\n    downloadsFullUrl: fullUrls,\n  };\n\n  var saGlobal = setting(\"saGlobal\", \"string\", \"sa_event\");\n\n  // For compiling the script\n  var optionsLink = options;\n\n  if (typeof optionsLink === \"undefined\")\n    log(\"options object not found, please specify\", \"warn\");\n\n  var saAutomatedLink = function saAutomatedLink(element, type) {\n    try {\n      if (!element) return log(\"no element found\");\n      var sent = false;\n\n      var callback = function () {\n        if (!sent && !element.hasAttribute(\"target\"))\n          document.location = element.getAttribute(\"href\");\n        sent = true;\n      };\n\n      if (window[saGlobal] && window[saGlobal + \"_loaded\"]) {\n        var hostname = element.hostname;\n        var pathname = element.pathname;\n\n        var event;\n        var metadata = {\n          title: element.getAttribute(\"title\") || undefined,\n        };\n        var url = element.href || undefined;\n\n        var useTitle = false;\n        if (optionsLink.title && element.hasAttribute(\"title\")) {\n          var theTitle = element.getAttribute(\"title\").trim();\n          if (theTitle != \"\") useTitle = true;\n        }\n\n        if (useTitle) {\n          event = theTitle;\n        } else {\n          switch (type) {\n            case \"outbound\": {\n              event = hostname + (optionsLink.outboundFullUrl ? pathname : \"\");\n              metadata.url = url;\n              break;\n            }\n            case \"download\": {\n              event = optionsLink.downloadsFullUrl\n                ? hostname + pathname\n                : pathname.split(\"/\").pop();\n              metadata.url = url;\n              break;\n            }\n            case \"email\": {\n              var href = element.getAttribute(\"href\");\n              event = (href.split(\":\")[1] || \"\").split(\"?\")[0];\n              metadata.email = event;\n              break;\n            }\n          }\n        }\n\n        var clean =\n          type +\n          \"_\" +\n          event.replace(/[^a-z0-9]+/gi, \"_\").replace(/(^_+|_+$)/g, \"\");\n\n        window[saGlobal](clean, metadata, callback);\n\n        log(\"collected \" + clean);\n\n        return type === \"email\"\n          ? callback()\n          : window.setTimeout(callback, 5000);\n      } else {\n        log(saGlobal + \" is not defined\", \"warn\");\n        return callback();\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  };\n\n  window.saAutomatedLink = saAutomatedLink;\n\n  function collectLink(link, onclick) {\n    if (link.hasAttribute(\"data-simple-event\")) return;\n    var collect = false;\n\n    // Collect download clicks\n    if (\n      optionsLink.downloads &&\n      /^https?:\\/\\//i.test(link.href) &&\n      new RegExp(\n        \"\\\\.(\" + (optionsLink.downloadsExtensions || []).join(\"|\") + \")$\",\n        \"i\"\n      ).test(link.pathname)\n    ) {\n      collect = \"download\";\n\n      // Collect outbound links clicks\n    } else if (\n      optionsLink.outbound &&\n      /^https?:\\/\\//i.test(link.href) &&\n      link.hostname !== window.location.hostname\n    ) {\n      collect = \"outbound\";\n\n      // Collect email clicks\n    } else if (optionsLink.emails && /^mailto:/i.test(link.href)) {\n      collect = \"email\";\n    }\n\n    if (!collect) return;\n\n    if (onclick) {\n      var onClickAttribute = \"saAutomatedLink(this, '\" + collect + \"');\";\n\n      if (\n        !link.hasAttribute(\"target\") ||\n        link.getAttribute(\"target\") === \"_self\"\n      )\n        onClickAttribute += \" return false;\";\n\n      link.setAttribute(\"onclick\", onClickAttribute);\n    } else {\n      link.addEventListener(\"click\", function () {\n        saAutomatedLink(link, collect);\n      });\n    }\n  }\n\n  function onDOMContentLoaded() {\n    try {\n      var a = document.getElementsByTagName(\"a\");\n\n      // Loop over all links on the page\n      for (var i = 0; i < a.length; i++) {\n        var link = a[i];\n        var href = link.getAttribute(\"href\");\n\n        // Skip links that don't have an href\n        if (!href) continue;\n\n        // We don't want to overwrite website behaviour so we check for the onclick attribute\n        if (!link.getAttribute(\"onclick\") && !/^mailto:/.test(href)) {\n          collectLink(link, true);\n        } else {\n          collectLink(link, false);\n        }\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  }\n\n  if (doc.readyState === \"ready\" || doc.readyState === \"complete\") {\n    onDOMContentLoaded();\n  } else {\n    document.addEventListener(\"readystatechange\", function (event) {\n      if (event.target.readyState === \"complete\") onDOMContentLoaded();\n    });\n  }\n})(window);\n"],"names":["collectLink","link","onclick","collect","onClickAttribute","hasAttribute","optionsLink","downloads","test","href","RegExp","downloadsExtensions","join","pathname","outbound","hostname","window","location","emails","getAttribute","setAttribute","addEventListener","saAutomatedLink","onDOMContentLoaded","a","document","getElementsByTagName","i","length","error","log","message","doc","scriptElement","setting","collectTypes","fullUrls","options","saGlobal","type","logger","console","warn","info","currentScript","querySelector","attribute","defaultValue","value","dataset","split","map","item","trim","filter","Boolean","indexOf","title","outboundFullUrl","downloadsFullUrl","element","sent","callback","theTitle","metadata","undefined","url","useTitle","event","pop","email","clean","replace","setTimeout","readyState","target"],"mappings":"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"}