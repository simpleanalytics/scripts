{"version":3,"file":"auto-events.source.js","sources":["auto-events.source.js"],"sourcesContent":["(function saAutomatedEvents(window) {\n  // Skip server side rendered pages\n  if (typeof window === \"undefined\") return;\n\n  var log = function (message, type) {\n    var logger = type === \"warn\" ? console.warn : console.info;\n    return logger && logger(\"Simple Analytics auto events:\", message);\n  };\n\n  var doc = window.document;\n\n  var scriptElement =\n    doc.currentScript || doc.querySelector('script[src*=\"auto-events.js\"]');\n\n  var setting = function (attribute, type, defaultValue) {\n    var value = scriptElement && scriptElement.dataset[attribute];\n\n    // Booleans\n    if (type === \"bool\" && (value === \"true\" || value === \"false\"))\n      return value === \"true\";\n    else if (type === \"bool\") return defaultValue;\n\n    // Arrays\n    if (type === \"array\" && value)\n      return value\n        .split(\",\")\n        .map(function (item) {\n          return item.trim();\n        })\n        .filter(Boolean);\n    else if (type === \"array\") return defaultValue;\n\n    return value || defaultValue;\n  };\n\n  var collectTypes = setting(\"collect\", \"array\", [\n    \"outbound\",\n    \"emails\",\n    \"downloads\",\n  ]);\n  var fullUrls = setting(\"fullUrls\", \"bool\", false);\n\n  var options = {\n    // What to collect\n    outbound: collectTypes.indexOf(\"outbound\") > -1,\n    emails: collectTypes.indexOf(\"emails\") > -1,\n    downloads: collectTypes.indexOf(\"downloads\") > -1,\n    // Downloads: enter file extensions you want to collect\n    downloadsExtensions: setting(\"extensions\", \"array\", [\n      \"pdf\",\n      \"csv\",\n      \"docx\",\n      \"xlsx\",\n      \"zip\",\n      \"doc\",\n      \"xls\",\n    ]),\n\n    // All: use title attribute if set for event name (for all events)\n    // THIS TAKES PRECEDENCE OVER OTHER SETTINGS BELOW\n    title: setting(\"useTitle\", \"bool\", true),\n    // Outbound: use full URL of the links? false for just the hostname\n    outboundFullUrl: fullUrls,\n    // Downloads: if taking event name from URL, use full URL or just filename (default)\n    downloadsFullUrl: fullUrls,\n  };\n\n  var saGlobal = setting(\"saGlobal\", \"string\", \"sa_event\");\n\n  // For compiling the script\n  var optionsLink = options;\n\n  if (typeof optionsLink === \"undefined\")\n    log(\"options object not found, please specify\", \"warn\");\n\n  window.saAutomatedLink = function saAutomatedLink(element, type) {\n    try {\n      if (!element) return log(\"no element found\");\n      var sent = false;\n\n      var callback = function () {\n        if (!sent && !element.hasAttribute(\"target\"))\n          document.location = element.getAttribute(\"href\");\n        sent = true;\n      };\n\n      if (window[saGlobal] && window[saGlobal + \"_loaded\"]) {\n        var hostname = element.hostname;\n        var pathname = element.pathname;\n\n        var event;\n        var metadata = {\n          title: element.getAttribute(\"title\") || undefined,\n        };\n        var url = element.href || undefined;\n\n        var useTitle = false;\n        if (optionsLink.title && element.hasAttribute(\"title\")) {\n          var theTitle = element.getAttribute(\"title\").trim();\n          if (theTitle != \"\") useTitle = true;\n        }\n\n        if (useTitle) {\n          event = theTitle;\n        } else {\n          switch (type) {\n            case \"outbound\": {\n              event = hostname + (optionsLink.outboundFullUrl ? pathname : \"\");\n              metadata.url = url;\n              break;\n            }\n            case \"download\": {\n              event = optionsLink.downloadsFullUrl\n                ? hostname + pathname\n                : pathname.split(\"/\").pop();\n              metadata.url = url;\n              break;\n            }\n            case \"email\": {\n              var href = element.getAttribute(\"href\");\n              event = (href.split(\":\")[1] || \"\").split(\"?\")[0];\n              metadata.email = event;\n              break;\n            }\n          }\n        }\n\n        var clean =\n          type +\n          \"_\" +\n          event.replace(/[^a-z0-9]+/gi, \"_\").replace(/(^_+|_+$)/g, \"\");\n\n        window[saGlobal](clean, metadata, callback);\n\n        log(\"collected \" + clean);\n\n        return type === \"email\"\n          ? callback()\n          : window.setTimeout(callback, 5000);\n      } else {\n        log(saGlobal + \" is not defined\", \"warn\");\n        return callback();\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  };\n\n  function collectLink(link, onclick) {\n    var collect = false;\n\n    // Collect download clicks\n    if (\n      optionsLink.downloads &&\n      /^https?:\\/\\//i.test(link.href) &&\n      new RegExp(\n        \"\\\\.(\" + (optionsLink.downloadsExtensions || []).join(\"|\") + \")$\",\n        \"i\"\n      ).test(link.pathname)\n    ) {\n      collect = \"download\";\n\n      // Collect outbound links clicks\n    } else if (\n      optionsLink.outbound &&\n      /^https?:\\/\\//i.test(link.href) &&\n      link.hostname !== window.location.hostname\n    ) {\n      collect = \"outbound\";\n\n      // Collect email clicks\n    } else if (optionsLink.emails && /^mailto:/i.test(link.href)) {\n      collect = \"email\";\n    }\n\n    if (!collect) return;\n\n    if (onclick) {\n      var onClickAttribute = \"saAutomatedLink(this, '\" + collect + \"');\";\n\n      if (\n        !link.hasAttribute(\"target\") ||\n        link.getAttribute(\"target\") === \"_self\"\n      )\n        onClickAttribute += \" return false;\";\n\n      link.setAttribute(\"onclick\", onClickAttribute);\n    } else {\n      link.addEventListener(\"click\", function (element) {\n        saAutomatedLink(element.target, collect);\n      });\n    }\n  }\n\n  function onDOMContentLoaded() {\n    try {\n      var a = document.getElementsByTagName(\"a\");\n\n      // Loop over all links on the page\n      for (var i = 0; i < a.length; i++) {\n        var link = a[i];\n        var href = link.getAttribute(\"href\");\n\n        // Skip links that don't have an href\n        if (!href) continue;\n\n        // We don't want to overwrite website behaviour so we check for the onclick attribute\n        if (!link.getAttribute(\"onclick\") && !/^mailto:/.test(href)) {\n          collectLink(link, true);\n        } else {\n          collectLink(link, false);\n        }\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  }\n\n  if (doc.readyState === \"ready\" || doc.readyState === \"complete\") {\n    onDOMContentLoaded();\n  } else {\n    document.addEventListener(\"readystatechange\", function (event) {\n      if (event.target.readyState === \"complete\") onDOMContentLoaded();\n    });\n  }\n})(window);\n"],"names":["collectLink","link","onclick","onClickAttribute","collect","optionsLink","downloads","test","href","RegExp","downloadsExtensions","join","pathname","outbound","hostname","window","location","emails","hasAttribute","getAttribute","setAttribute","addEventListener","element","saAutomatedLink","target","onDOMContentLoaded","a","document","getElementsByTagName","i","length","error","log","message","doc","scriptElement","setting","collectTypes","fullUrls","options","saGlobal","type","logger","console","warn","info","currentScript","querySelector","attribute","defaultValue","value","dataset","split","map","item","trim","filter","Boolean","indexOf","title","outboundFullUrl","downloadsFullUrl","sent","callback","theTitle","metadata","undefined","url","useTitle","event","pop","email","clean","replace","setTimeout","readyState"],"mappings":"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"}